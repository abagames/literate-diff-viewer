## ワンボタンミニゲームPIN CLIMBを作る

この記事では、[crisp-game-lib](https://github.com/abagames/crisp-game-lib)を使ったワンボタンミニゲームの作り方を説明します。

ワンボタンミニゲームを作るには、ワンボタンにどのような機能を割り当てるかを考えることが重要です。詳しくは、以下の記事を参照ください。

- [ワンボタンゲームをたくさん作ったので、その作り方をおさらいしたい](https://aba.hatenablog.com/entry/2021/08/08/195706)

今回作るゲームでは、ボタンに「伸びる」という機能を割り当てます。ゲームのルールを以下に示します。

- あなたはくるくる回る「棒」を操作します
- 棒はボタンを押している間伸びて、ボタンを離すと縮みます
- 棒は「ピン」を中心に回ります
- ピンは画面の上端から出現して下方向にスクロールします
- 棒が他のピンに引っかかると、棒はそのピンが中心になるように移動します
- 棒が画面の下端に移動してしまうとゲームオーバーです

<br><br><br><br><br><br><br><br><br><br>

### テンプレートのソースコードを準備する

(src) [0_template.js](./src/0_template.js)

`crisp-game-lib`を使ってゲームを作るには、まずテンプレートとなるソースコードを準備する必要があります。詳しくは、[始め方](https://github.com/abagames/crisp-game-lib/blob/master/README_ja.md#%E5%A7%8B%E3%82%81%E6%96%B9)を見てください。

<br>

ここでこの記事の見方を説明します。画面右にソースコードが表示されていますか？表示されていない場合は、この文章が画面中央より上に来るまで、画面を下へスクロールしてください。

画面右には新たに追記したソースコードが表示されます。表示は[diffのユニファイド形式](https://ja.wikipedia.org/wiki/Diff#%E3%83%A6%E3%83%8B%E3%83%95%E3%82%A1%E3%82%A4%E3%83%89%E5%BD%A2%E5%BC%8F_(Unified_format))で表示され、行頭に`+`がある行が追記した行、`-`がある行が削除した行です。

画面右下には、現在のソースコードで実現されるゲーム画面が表示されます。今はスコアとハイスコアが表示されているだけです。

<br>

画面右のテンプレートを見てみましょう。`title`, `description`はゲームのタイトルと説明を設定するための変数、`characters`は画面に表示するドット絵を定義するための変数、`options`はゲームの設定を行うための変数です。これらの変数は後ほど設定します。

`update`関数に、ゲームのロジックを記述します。`update`関数は1秒に60回呼び出され、ゲーム画面の描画やマウス操作に反応する処理などを行います。

`update`関数内にある`ticks`変数は、ゲーム開始時は0で、1/60秒ごとに1加算されます。`if (!ticks) {}`は`if (ticks === 0) {}`と同じ意味で、ゲーム開始時に行う初期化の処理が、`{}`内で行えます。

### ピンを表示する

(src) [1_pins_variable.js](./src/1_pins_variable.js)

ピンを画面に表示します。`pins`配列変数を宣言します。必須ではないですが、`@types`を含むコメントを使って、変数の型を宣言すると、エラー検出やコード補完をする際に役立ちます。`pins`変数は`[vec(50, 0)]`で初期化します。`vec()`関数は2次元のベクトルである`Vector`インスタンスを生成します。`Vector`インスタンスは、(x, y)座標を扱う際に便利な関数群を備えています。

`forEach`を使って、`pins`の各要素を座標として`box`、つまり四角を描画します。`box`関数は第1引数に座標を、第2引数にその大きさを指定します。`crisp-game-lib`の画面は100x100ドットで構成されていて、左上が(0, 0)、右下が(99, 99)です。

### ピンを追加しスクロールさせる

(src_hide) 1a_pins_variables_p.js

(src) [2_add_pins.js](./src/2_add_pins.js)

ピンをある程度の間隔で画面上端から出現させ、下にスクロールさせます。`nextPinDist`に次のピンまでの距離を設定します。`scr`にはスクロールさせるY座標の距離を設定し、各ピンのY座標に`scr`の値を加えます。

`nextPinDist`が0より小さな値になった場合、配列の`push`関数を使って新たなピンを追加します。ピンのX座標は`rnd`関数を使ってランダムに設定します。`rnd`関数は第1引数から第2引数までの間の値を返します。次のピンまでの距離も`rnd`関数を使って算出し、`nextPinDist`を加算します。

<br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br>
